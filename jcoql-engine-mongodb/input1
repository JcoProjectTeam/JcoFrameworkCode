GET COLLECTION tweetMorphia@prova;
EXPAND 
UNPACK
WITH ARRAY .geo
ARRAY .geo
TO elem
DROP OTHERS;
FILTER 
CASE 
WHERE .elem.position = 0
DROP OTHERS;
SET INTERMEDIATE AS t0;
GET COLLECTION tweet@prova;
EXPAND 
UNPACK
WITH ARRAY .geo
ARRAY .geo
TO elem
DROP OTHERS;
FILTER 
CASE 
WHERE .elem.position = 1
DROP OTHERS;
SET INTERMEDIATE AS t1;
JOIN OF COLLECTIONS t0 AS L, t1 AS R
CASE 
WHERE .L._id = .R._id
GENERATE
SETTING GEOMETRY POINT(.L.elem.item,.R.elem.item)
DROP OTHERS;
SET INTERMEDIATE AS twitter;
SPATIAL JOIN OF COLLECTIONS piazza@prova, twitter
ON INTERSECT
SET GEOMETRY RIGHT;
GROUP 
PARTITION
WITHOUT .aaaa
BY .aaaa
INTO .campo
GENERATE
SETTING GEOMETRY AGGREGATE(.campo)
DROP OTHERS;
SAVE AS result@prova;